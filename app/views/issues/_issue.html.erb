<div class="page-header">
    <h1>
        <%= @issue.type.name %>
        <span class="text-muted fs-6">
            <% if @issue.input_vector.affected_input_name %>
                in <%= @issue.input_vector %> input
                <code><%= @issue.input_vector.affected_input_name %></code>
            <% end %>

            at
            <%= link_to_url_with_external(
                    external: @issue.referring_page.dom.url,
                    internal: site_path(
                        @site,
                        sitemap_entry_url( issue.referring_page.sitemap_entry )
                    ),
                    display_path_only: true
                )
            %>
            pointing to
            <%= link_to_url_with_external(
                    external: @issue.input_vector.action,
                    internal: site_path(
                        @site,
                        sitemap_entry_url( issue.input_vector.sitemap_entry )
                    ),
                    display_path_only: true
                )
            %>.
        </span>
    </h1>

    <h3>
        <p class="pull-left badge label-severity-<%= @issue.severity.to_s.downcase %>">
            <%= @issue.severity.to_s.capitalize %> severity
        </p>
    </h3>
</div>

<%
   has_references = (@issue.type.references.any? || @issue.type.cwe) ? true : nil
%>

<div class="row" id="info">
    <div class="col-md-<%= has_references ? 10 : 12 %>">
        <div class="description">
            <%= md @issue.description %>
        </div>
    </div>

    <% if has_references %>
    <div class="col-md-2 references">
        <strong>References</strong>

        <ul class="list-unstyled">
            <% if @issue.type.cwe_url %>
            <li>
                <%= link_to 'CWE', @issue.type.cwe_url, target: '_blank' %>
            </li>
            <% end %>

            <% @issue.type.references.each do |reference| %>
                <li>
                    <%= link_to reference.title, reference.url, target: '_blank' %>
                </li>
            <% end %>
        </ul>
    </div>
    <% end %>
</div>

<hr/>

<div class="mt-3" id="input_vector">
    <h2>
        <a class="anchor" href="#!/input_vector">
            <span class="fa fa-link"></span>
        </a>

        Input vector
    </h2>
    <%= render 'issues/input_vector', issue: issue %>
</div>

<hr/>

<div class="mt-3" id="reproduction">
    <h2>
        <a class="anchor" href="#!/reproduction">
            <span class="fa fa-link"></span>
        </a>

        Reproduction
    </h2>

    <%= render 'issues/reproduction', issue: issue %>
</div>

<hr/>

<% if @issue.has_proofs? %>
<div class="mt-3" id="identification">
    <h2>
        <a class="anchor" href="#!/identification">
            <span class="fa fa-link"></span>
        </a>

        Identification
    </h2>

    <%= render 'issues/identification', issue: issue %>
</div>

<hr/>
<% end %>

<% if @issue.patch %>
  <div class="mt-3" id="patch">
    <h2>
      <a class="anchor" href="#!/patch">
        <span class="fa fa-link"></span>
      </a>

      Patching
    </h2>

    <%= md issue.patch %>
  </div>

  <hr/>
<% end %>

<% if @issue.exploit %>
  <div class="mt-3" id="exploit">
    <h2>
      <a class="anchor" href="#!/exploit">
        <span class="fa fa-link"></span>
      </a>

      Exploitation
    </h2>

    <%= md issue.exploit %>
  </div>

  <hr/>
<% end %>

<% if @issue.remediation_guidance %>
    <div class="mt-3" id="remediation_guidance">
        <h2>
            <a class="anchor" href="#!/remediation_guidance">
                <span class="fa fa-link"></span>
            </a>

            Remediation guidance
        </h2>

        <%= render 'issues/remediation_guidance', issue: issue %>
    </div>

    <hr/>
<% end %>

<% if @issue.remediation_code %>
  <div class="mt-3" id="remediation_code">
    <h2>
      <a class="anchor" href="#!/remediation_code">
        <span class="fa fa-link"></span>
      </a>

      Remediation code
    </h2>

    <%= md issue.remediation_code %>
  </div>

  <hr/>
<% end %>

<% if @issue.report %>
  <div class="mt-3" id="report">
    <h2>
      <a class="anchor" href="#!/report">
        <span class="fa fa-link"></span>
      </a>

      Report
    </h2>

    <%= md issue.report %>
  </div>

  <hr/>
<% end %>

<div class="mt-3" id="advanced">
    <h2>
        <a class="anchor" href="#!/advanced">
            <span class="fa fa-link"></span>
        </a>

        Advanced information
    </h2>

    <p class="text-muted">
        The following sections provide all available data regarding the
        state of the web application and associated traffic.
    </p>

    <%= render 'issues/advanced', issue: issue %>
</div>
