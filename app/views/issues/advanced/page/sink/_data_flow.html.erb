<%
   include_taint ||= false
%>

<% if include_taint %>
<p class="alert alert-info">
    Taint is:
    <code><%= page.dom.data_flow_sinks.first.taint_value %></code>
</p>
<% end %>

<table class="table table-sm table-fixed table-data-flow-sinks">
    <colgroup>
        <col width="4%"/>
        <col width="45%"/>
        <col width="47%"/>
        <col width="6%"/>
    </colgroup>

    <thead>
        <tr>
            <th>#</th>
            <th>Object</th>
            <th>Function</th>
            <th></th>
        </tr>
    </thead>
    <% page.dom.data_flow_sinks.sort_by(&:id).each.with_index do |sink, i| %>
        <tr id="<%= id %>-data_flow_sinks-<%= i %>">
            <th>
                <a href="<%= id_to_location id %>/data_flow_sinks/<%= i %>">
                    <%= i %>
                </a>
            </th>
            <td>
                <code><%= sink.object %></code>
            </td>
            <td>
                <code><%= sink.function.signature || sink.function.name %></code>
            </td>
            <td>
                <a href="javascript:void(0);"
                   onclick="$('#<%= id %>-data_flow_sinks-<%= i %>-inspect').toggle()"
                   class="btn btn-info btn-sm">
                    Inspect
                </a>
            </td>
        </tr>
        <tr id="<%= id %>-data_flow_sinks-<%= i %>-inspect" class="inspection">
            <td colspan="4">

                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-turbo="false" href="<%= id_to_location id %>/data_flow_sinks/<%= i %>/inspect/arguments">
                            Arguments
                        </a>
                    </li>

                    <% if !sink.function.source.to_s.empty? %>
                        <li>
                            <a data-turbo="false" href="<%= id_to_location id %>/data_flow_sinks/<%= i %>/inspect/source">
                                Source
                            </a>
                        </li>
                    <% end %>

                    <% if sink.stackframes.any? %>
                        <li>
                            <a data-turbo="false" href="<%= id_to_location id %>/data_flow_sinks/<%= i %>/inspect/stacktrace">
                                Stacktrace
                            </a>
                        </li>
                    <% end %>

                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="<%= id %>-data_flow_sinks-<%= i %>-inspect-arguments">
                        <%= render 'issues/advanced/page/sink/data_flow/arguments',
                                id:   "#{id}-data_flow_sinks-#{i}-inspect",
                                sink: sink
                        %>
                    </div>

                    <% if !sink.function.source.to_s.empty? %>
                        <div class="tab-pane" id="<%= id %>-data_flow_sinks-<%= i %>-inspect-source">
                            <%= render 'issues/advanced/page/sink/data_flow/source',
                                    id:     "#{id}-data_flow_sinks-#{i}-inspect",
                                    source: sink.function.source
                            %>
                        </div>
                    <% end %>

                    <% if sink.stackframes.any? %>
                        <div class="tab-pane" id="<%= id %>-data_flow_sinks-<%= i %>-inspect-stacktrace">
                            <%= render 'issues/advanced/page/sink/trace/table',
                                    id:    "#{id}-data_flow_sinks-#{i}-inspect-stacktrace",
                                    parent_id: id,
                                    trace: sink.stackframes,
                                    page:  page
                            %>
                        </div>
                    <% end %>
                </div>

            </td>
        </tr>
    <% end %>
</table>
